<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>编写typescript声明文件 | 车程一的博客</title>
    <meta name="description" content="车程一的博客">
    <link rel="icon" href="/vue-logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.2fbf6f8b.css" as="style"><link rel="preload" href="/assets/js/app.7b18d2f0.js" as="script"><link rel="preload" href="/assets/js/38.ca058290.js" as="script"><link rel="prefetch" href="/assets/js/10.ea08bc69.js"><link rel="prefetch" href="/assets/js/11.59d62fd9.js"><link rel="prefetch" href="/assets/js/12.426af9d7.js"><link rel="prefetch" href="/assets/js/13.b2bd6144.js"><link rel="prefetch" href="/assets/js/14.1790ff5e.js"><link rel="prefetch" href="/assets/js/15.584f93ea.js"><link rel="prefetch" href="/assets/js/16.659d2a43.js"><link rel="prefetch" href="/assets/js/17.7825b058.js"><link rel="prefetch" href="/assets/js/18.0b08fef9.js"><link rel="prefetch" href="/assets/js/19.c553a9ae.js"><link rel="prefetch" href="/assets/js/2.ef1579f9.js"><link rel="prefetch" href="/assets/js/20.1a95086a.js"><link rel="prefetch" href="/assets/js/21.57c66887.js"><link rel="prefetch" href="/assets/js/22.3570ca0d.js"><link rel="prefetch" href="/assets/js/23.7fe8ebe9.js"><link rel="prefetch" href="/assets/js/24.5c706192.js"><link rel="prefetch" href="/assets/js/25.d8757158.js"><link rel="prefetch" href="/assets/js/26.8399a71b.js"><link rel="prefetch" href="/assets/js/27.4b3a213a.js"><link rel="prefetch" href="/assets/js/28.eb31cdf1.js"><link rel="prefetch" href="/assets/js/29.577144a6.js"><link rel="prefetch" href="/assets/js/3.62eea2c7.js"><link rel="prefetch" href="/assets/js/30.ef956d23.js"><link rel="prefetch" href="/assets/js/31.2e8ab40d.js"><link rel="prefetch" href="/assets/js/32.9d1685a0.js"><link rel="prefetch" href="/assets/js/33.d800be4d.js"><link rel="prefetch" href="/assets/js/34.85d350fe.js"><link rel="prefetch" href="/assets/js/35.1625e166.js"><link rel="prefetch" href="/assets/js/36.5cf7699d.js"><link rel="prefetch" href="/assets/js/37.0437fe8d.js"><link rel="prefetch" href="/assets/js/39.d4f95e20.js"><link rel="prefetch" href="/assets/js/4.91c625b2.js"><link rel="prefetch" href="/assets/js/40.211acfac.js"><link rel="prefetch" href="/assets/js/41.a5df0168.js"><link rel="prefetch" href="/assets/js/42.6318b490.js"><link rel="prefetch" href="/assets/js/43.a6543bac.js"><link rel="prefetch" href="/assets/js/44.b04565e5.js"><link rel="prefetch" href="/assets/js/45.3bb1a5c1.js"><link rel="prefetch" href="/assets/js/46.15ed4362.js"><link rel="prefetch" href="/assets/js/47.e838dcd2.js"><link rel="prefetch" href="/assets/js/48.0a220d6c.js"><link rel="prefetch" href="/assets/js/49.a81b7774.js"><link rel="prefetch" href="/assets/js/5.a6bc510c.js"><link rel="prefetch" href="/assets/js/50.5ae2a1df.js"><link rel="prefetch" href="/assets/js/51.1e50c0a5.js"><link rel="prefetch" href="/assets/js/52.05832c5b.js"><link rel="prefetch" href="/assets/js/6.edf1ab01.js"><link rel="prefetch" href="/assets/js/7.75a4d63f.js"><link rel="prefetch" href="/assets/js/8.ac427bc7.js"><link rel="prefetch" href="/assets/js/9.7c5ccd0b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2fbf6f8b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">车程一的博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div> <a href="https://github.com/chechengyi" target="_blank" rel="noopener noreferrer" class="repo-link">
    我的github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div> <a href="https://github.com/chechengyi" target="_blank" rel="noopener noreferrer" class="repo-link">
    我的github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>前端实战</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>js相关</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>react理解</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>总结记录</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/blog/总结记录/浏览器渲染过程以及事件循环.html" class="sidebar-link">浏览器渲染过程以及事件循环</a></li><li><a href="/blog/总结记录/Sequelize使用记录.html" class="sidebar-link">Sequelize 使用记录</a></li><li><a href="/blog/总结记录/TCP、http、udp记录.html" class="sidebar-link">TCP、http、udp记录</a></li><li><a href="/blog/总结记录/https 原理与传输.html" class="sidebar-link">https 原理与传输</a></li><li><a href="/blog/总结记录/编写typescript声明文件.html" class="active sidebar-link">编写typescript声明文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/总结记录/编写typescript声明文件.html#_1-package-json-处定义声明文件入口" class="sidebar-link">1 package.json 处定义声明文件入口</a></li><li class="sidebar-sub-header"><a href="/blog/总结记录/编写typescript声明文件.html#_2-书写声明文件" class="sidebar-link">2 书写声明文件</a></li><li class="sidebar-sub-header"><a href="/blog/总结记录/编写typescript声明文件.html#_2-1-全局变量" class="sidebar-link">2.1 全局变量</a></li><li class="sidebar-sub-header"><a href="/blog/总结记录/编写typescript声明文件.html#_2-npm包" class="sidebar-link">2 npm包</a></li><li class="sidebar-sub-header"><a href="/blog/总结记录/编写typescript声明文件.html#_2-1-commonjs-规范中的导出：export" class="sidebar-link">2.1 commonjs 规范中的导出：export =</a></li><li class="sidebar-sub-header"><a href="/blog/总结记录/编写typescript声明文件.html#_3-umd库" class="sidebar-link">3 umd库</a></li><li class="sidebar-sub-header"><a href="/blog/总结记录/编写typescript声明文件.html#_4-直接扩展全局变量" class="sidebar-link">4 直接扩展全局变量</a></li><li class="sidebar-sub-header"><a href="/blog/总结记录/编写typescript声明文件.html#_5-通过导入扩展全局变量" class="sidebar-link">5 通过导入扩展全局变量</a></li></ul></li><li><a href="/blog/总结记录/Docker 安装及使用.html" class="sidebar-link">Docker 使用</a></li><li><a href="/blog/总结记录/JS位运算.html" class="sidebar-link">JS位运算</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>数据结构算法</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="编写typescript声明文件"><a href="#编写typescript声明文件" aria-hidden="true" class="header-anchor">#</a> 编写typescript声明文件</h1> <p><code>typescript</code> 的使用现在是已经越来越普及了。今天记录一个让我把头发都抓掉了几根的，声明文件的编写。</p> <p>事情是这样的，我之前编写过一个关于 <code>localStorage</code> 的库，使用js编写的，然后我想要在 <code>typescript</code> 的项目使用中能够有友好的声明提示。将原本的项目全部使用 <code>typescript</code> 重写显然是工作量比较大的(这里需要注意一点，这种提供出去的公共模块一定是要打包过后的，因为很多实际的项目中打包时候是会忽略node_modules的，所以即使使用 <code>typescript</code> 编写的，最终还是要打包，在打包的时候需要先执行tsc命令生成类型声明文件)。所以，我选择了编写一个声明文件去解决我的需求。</p> <h2 id="_1-package-json-处定义声明文件入口"><a href="#_1-package-json-处定义声明文件入口" aria-hidden="true" class="header-anchor">#</a> 1 package.json 处定义声明文件入口</h2> <p>以为的库为实际例子，当我们编写了声明文件后，需要在 <code>package.json</code> 文件里定义一下。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;release/storage.js&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;release/storage.d.ts&quot;</span><span class="token punctuation">,</span>
</code></pre></div><p>在我的项目中，最终项目打包后是在一个叫做 <code>release</code> 的文件夹中，<code>package.json</code> 的 <code>main</code> 字段代表的是文件入口，在它的同级有一个 <code>storage.d.ts</code> 声明文件，此时将它的路径写到 <code>types</code> 字段处, 代表这是声明文件。</p> <h2 id="_2-书写声明文件"><a href="#_2-书写声明文件" aria-hidden="true" class="header-anchor">#</a> 2 书写声明文件</h2> <p>在编写声明文件的时候，主要使用的场景有以下几种：</p> <ol><li>全局变量，指的是通过 <code>script</code> 标签引入的第三方库。</li> <li>npm包，通过 <code>import</code> 使用</li> <li>UMD库，即支持 <code>script</code> 标签引入，又可以通过 <code>import</code> 导入</li></ol> <h2 id="_2-1-全局变量"><a href="#_2-1-全局变量" aria-hidden="true" class="header-anchor">#</a> 2.1 全局变量</h2> <p>全局变量声明主要有以下几种语法：</p> <ol><li><p><code>declare var</code> 、<code>declare let</code>、<code>declare const</code><strong>声明全局变量</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">declare</span> <span class="token keyword">const</span> JQuery<span class="token punctuation">:</span> <span class="token punctuation">(</span>selector<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token builtin">any</span>
</code></pre></div></li> <li><p><code>declare function</code> <strong>声明全局方法</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">JQuery</span><span class="token punctuation">(</span>selector<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">any</span>
</code></pre></div></li> <li><p><code>declare class</code> <strong>声明全局类</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">declare</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>declare namespace</code> <strong>声明全局对象（含有子属性使用 namespace）</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">declare</span> <span class="token keyword">namespace</span> JQuery <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> version<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果对象拥有深层的层级，则可以继续使用 <code>namespace</code> 来声明深层的属性：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">declare</span> <span class="token keyword">namespace</span> Storage <span class="token punctuation">{</span>

  <span class="token keyword">type</span> Key <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">type</span> Value <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">type</span> Time <span class="token operator">=</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token comment">// interface Session {</span>
  <span class="token comment">//   get: (key: Key) =&gt; string;</span>
  <span class="token comment">//   save: (key: Key, value: Value) =&gt; void;</span>
  <span class="token comment">//   remove: (key: Key, value: Value) =&gt; void;</span>
  <span class="token comment">//   clear: () =&gt; void;</span>
  <span class="token comment">// }</span>

  <span class="token keyword">function</span> <span class="token keyword">get</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> Key<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">save</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> Key<span class="token punctuation">,</span> value<span class="token punctuation">:</span> Value<span class="token punctuation">,</span> time<span class="token operator">?</span><span class="token punctuation">:</span> Time<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> Key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">on</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> Key<span class="token punctuation">,</span> fn<span class="token punctuation">:</span> <span class="token builtin">Function</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span>
  <span class="token keyword">function</span> <span class="token function">off</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> Key<span class="token punctuation">,</span> fn<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">Function</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token comment">// const session: Session;</span>
  <span class="token keyword">namespace</span> session <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token keyword">get</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> Key<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">save</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> Key<span class="token punctuation">,</span> value<span class="token punctuation">:</span> Value<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>比如 <code>sweet-storage</code> 中的定义，在声明 <code>Session</code> 的时候可以定义一个 <code>interface</code> 然后使用 <code>const</code> 去定义，也可以在前套一个 <code>namespace</code>。</p></li> <li><p><code>interface</code> 和 <code>type</code></p> <p>除了全局变量之外，有一些类型我们可能也希望能暴露出来。在类型声明文件中，我们可以直接使用 <code>interface</code> 或 <code>type</code> 来声明一个全局的类型。比如上面贴出的 <code>sweeet-storage</code> 的声明文件代码，在 <code>namespace Storage</code> 中定义了 <code>interface Session</code>，这样可以通过 <code>Storage.Session</code> 获取到类型。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// index.d.ts</span>
<span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">declare</span> <span class="token keyword">namespace</span> JQuery <span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name">Ceshi</span> <span class="token punctuation">{</span>
    age<span class="token punctuation">:</span> <span class="token builtin">number</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// index.ts</span>
<span class="token keyword">const</span> person<span class="token punctuation">:</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'ccy'</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> test<span class="token punctuation">:</span> JQuery<span class="token punctuation">.</span>Ceshi <span class="token operator">=</span> <span class="token punctuation">{</span>
  age<span class="token punctuation">:</span> <span class="token number">66</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h2 id="_2-npm包"><a href="#_2-npm包" aria-hidden="true" class="header-anchor">#</a> 2 npm包</h2> <p><strong>npm 包的声明文件与全局变量的声明文件有很大区别。在 npm 包的声明文件中，使用 <code>declare</code> 不再会声明一个全局变量，而只会在当前文件中声明一个局部变量。只有在声明文件中使用 <code>export</code> 导出，然后在使用方 <code>import</code> 导入后，才会应用到这些类型声明。</strong></p> <p><strong><code>export</code> 的语法与非声明文件中的语法类似，区别仅在于声明文件中禁止定义具体的值：</strong></p> <p>比如：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Options</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对应的引入应该是：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> getName<span class="token punctuation">,</span> Animal<span class="token punctuation">,</span> Directions<span class="token punctuation">,</span> Options <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> myName <span class="token operator">=</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> cat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options<span class="token punctuation">:</span> Options <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">'foo'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>注意，与全局变量的声明文件类似，<code>interface</code> 前是不需要 <code>declare</code> 的。</strong></p> <p>在 ES6 模块系统中，使用 <code>export default</code> 可以导出一个默认值，使用方可以用 <code>import foo from 'foo'</code> 而不是 <code>import { foo } from 'foo'</code> 来导入这个默认值。如：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>注意，只有 <code>function</code>、<code>class</code> 和 <code>interface</code> 可以直接默认导出，其他的变量需要先定义出来，再默认导出</strong></p> <h2 id="_2-1-commonjs-规范中的导出：export"><a href="#_2-1-commonjs-规范中的导出：export" aria-hidden="true" class="header-anchor">#</a> 2.1 <code>commonjs</code> 规范中的导出：<code>export =</code></h2> <p>在 commonjs 规范中，我们用以下方式来导出：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 整体导出</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> foo<span class="token punctuation">;</span>
<span class="token comment">// 单个导出</span>
exports<span class="token punctuation">.</span>bar <span class="token operator">=</span> bar<span class="token punctuation">;</span>
</code></pre></div><p>在 ts 中，针对这种导出，有多种方式可以导入，第一种方式是 <code>const ... = require</code>：</p> <div class="language- extra-class"><pre class="language-text"><code>// 整体导入
const foo = require('foo');
// 单个导入
const bar = require('foo').bar;
</code></pre></div><p>第二种方式是 <code>import ... from</code>，注意针对整体导出，需要使用 <code>import * as</code> 来导入：</p> <div class="language- extra-class"><pre class="language-text"><code>// 整体导入
import * as foo from 'foo';
// 单个导入
import { bar } from 'foo';
</code></pre></div><p>第三种方式是 <code>import ... require</code>，<strong>这也是 ts 官方推荐的方式：</strong></p> <div class="language- extra-class"><pre class="language-text"><code>// 整体导入
import foo = require('foo');
// 单个导入
import bar = require('foo').bar;
</code></pre></div><p>对于这种使用 commonjs 规范的库，假如要给它写类型声明文件的话，就需要使用到 <code>export =</code> 这种语法了：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token operator">=</span> foo<span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span> <span class="token keyword">namespace</span> foo <span class="token punctuation">{</span>
    <span class="token keyword">const</span> bar<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_3-umd库"><a href="#_3-umd库" aria-hidden="true" class="header-anchor">#</a> 3 umd库</h2> <p>既可以通过 <code>&lt;script&gt;</code> 标签引入，又可以通过 <code>import</code> 导入的库，称为 UMD 库。相比于 npm 包的类型声明文件，我们需要额外声明一个全局变量，为了实现这种方式，ts 提供了一个新语法 <code>export as namespace</code></p> <p>刚好 <code>sweet-storage</code> 就是一个umd库，这里直接贴上声明文件代码：</p> <div class="language-ts extra-class"><pre class="language-ts"><code>
<span class="token keyword">export</span> <span class="token keyword">default</span> Storage<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">as</span> <span class="token keyword">namespace</span> Storage<span class="token punctuation">;</span>


<span class="token keyword">declare</span> <span class="token keyword">namespace</span> Storage <span class="token punctuation">{</span>

  <span class="token keyword">type</span> Key <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">type</span> Value <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">type</span> Time <span class="token operator">=</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token keyword">interface</span> <span class="token class-name">Session</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">:</span> Key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    save<span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">:</span> Key<span class="token punctuation">,</span> value<span class="token punctuation">:</span> Value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    remove<span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">:</span> Key<span class="token punctuation">,</span> value<span class="token punctuation">:</span> Value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    clear<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token keyword">get</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> Key<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">save</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> Key<span class="token punctuation">,</span> value<span class="token punctuation">:</span> Value<span class="token punctuation">,</span> time<span class="token operator">?</span><span class="token punctuation">:</span> Time<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> Key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> session<span class="token punctuation">:</span> Session<span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">on</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> Key<span class="token punctuation">,</span> fn<span class="token punctuation">:</span> <span class="token builtin">Function</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span>
  <span class="token keyword">function</span> <span class="token function">off</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> Key<span class="token punctuation">,</span> fn<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">Function</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>作为对比，代码定义时候的写法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Storage <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">,</span>
  save<span class="token punctuation">,</span>
  remove<span class="token punctuation">,</span>
  clear<span class="token punctuation">,</span>
  session<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">:</span> session<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">,</span>
    save<span class="token punctuation">:</span> session<span class="token punctuation">.</span>save<span class="token punctuation">,</span>
    remove<span class="token punctuation">:</span> session<span class="token punctuation">.</span>remove<span class="token punctuation">,</span>
    clear<span class="token punctuation">:</span> session<span class="token punctuation">.</span>clear
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  on<span class="token punctuation">:</span> observer<span class="token punctuation">.</span>subscribe<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">,</span>
  off<span class="token punctuation">:</span> observer<span class="token punctuation">.</span>unsubscribe<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Storage
</code></pre></div><h2 id="_4-直接扩展全局变量"><a href="#_4-直接扩展全局变量" aria-hidden="true" class="header-anchor">#</a> 4 直接扩展全局变量</h2> <p>有的时候，我们在代码里面扩展了一个全局变量，可是它的类型却没有相应的更新过来，就会导致 ts 编译错误，此时就需要来扩展全局变量的类型。比如扩展 <code>String</code>：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
    <span class="token function">prependHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token string">'foo'</span><span class="token punctuation">.</span><span class="token function">prependHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>通过声明合并，使用 <code>interface String</code> 即可给全局变量 <code>String</code> 添加属性或方法</strong></p> <h2 id="_5-通过导入扩展全局变量"><a href="#_5-通过导入扩展全局变量" aria-hidden="true" class="header-anchor">#</a> 5 通过导入扩展全局变量</h2> <p>如之前所说，对于一个 npm 包或者 UMD 库的声明文件，只有 <code>export</code> 导出的类型声明才会有效。所以对于 npm 包或 UMD 库，如果导入此库之后会扩展全局变量，则需要使用另一种语法在声明文件中扩展全局变量的类型，那就是 <code>declare global</code>。</p> <p>declare global</p> <p>使用 <code>declare global</code> 可以在 npm 包或者 UMD 库中扩展全局变量的类型：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">declare</span> global <span class="token punctuation">{</span>
    <span class="token keyword">interface</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token function">prependHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> foo <span class="token keyword">from</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>
<span class="token string">'bar'</span><span class="token punctuation">.</span><span class="token function">prependHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.7b18d2f0.js" defer></script><script src="/assets/js/38.ca058290.js" defer></script>
  </body>
</html>
