<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>https 原理与传输 | 车程一的博客</title>
    <meta name="description" content="车程一的博客">
    <link rel="icon" href="/vue-logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.2fbf6f8b.css" as="style"><link rel="preload" href="/assets/js/app.7b18d2f0.js" as="script"><link rel="preload" href="/assets/js/32.9d1685a0.js" as="script"><link rel="prefetch" href="/assets/js/10.ea08bc69.js"><link rel="prefetch" href="/assets/js/11.59d62fd9.js"><link rel="prefetch" href="/assets/js/12.426af9d7.js"><link rel="prefetch" href="/assets/js/13.b2bd6144.js"><link rel="prefetch" href="/assets/js/14.1790ff5e.js"><link rel="prefetch" href="/assets/js/15.584f93ea.js"><link rel="prefetch" href="/assets/js/16.659d2a43.js"><link rel="prefetch" href="/assets/js/17.7825b058.js"><link rel="prefetch" href="/assets/js/18.0b08fef9.js"><link rel="prefetch" href="/assets/js/19.c553a9ae.js"><link rel="prefetch" href="/assets/js/2.ef1579f9.js"><link rel="prefetch" href="/assets/js/20.1a95086a.js"><link rel="prefetch" href="/assets/js/21.57c66887.js"><link rel="prefetch" href="/assets/js/22.3570ca0d.js"><link rel="prefetch" href="/assets/js/23.7fe8ebe9.js"><link rel="prefetch" href="/assets/js/24.5c706192.js"><link rel="prefetch" href="/assets/js/25.d8757158.js"><link rel="prefetch" href="/assets/js/26.8399a71b.js"><link rel="prefetch" href="/assets/js/27.4b3a213a.js"><link rel="prefetch" href="/assets/js/28.eb31cdf1.js"><link rel="prefetch" href="/assets/js/29.577144a6.js"><link rel="prefetch" href="/assets/js/3.62eea2c7.js"><link rel="prefetch" href="/assets/js/30.ef956d23.js"><link rel="prefetch" href="/assets/js/31.2e8ab40d.js"><link rel="prefetch" href="/assets/js/33.d800be4d.js"><link rel="prefetch" href="/assets/js/34.85d350fe.js"><link rel="prefetch" href="/assets/js/35.1625e166.js"><link rel="prefetch" href="/assets/js/36.5cf7699d.js"><link rel="prefetch" href="/assets/js/37.0437fe8d.js"><link rel="prefetch" href="/assets/js/38.ca058290.js"><link rel="prefetch" href="/assets/js/39.d4f95e20.js"><link rel="prefetch" href="/assets/js/4.91c625b2.js"><link rel="prefetch" href="/assets/js/40.211acfac.js"><link rel="prefetch" href="/assets/js/41.a5df0168.js"><link rel="prefetch" href="/assets/js/42.6318b490.js"><link rel="prefetch" href="/assets/js/43.a6543bac.js"><link rel="prefetch" href="/assets/js/44.b04565e5.js"><link rel="prefetch" href="/assets/js/45.3bb1a5c1.js"><link rel="prefetch" href="/assets/js/46.15ed4362.js"><link rel="prefetch" href="/assets/js/47.e838dcd2.js"><link rel="prefetch" href="/assets/js/48.0a220d6c.js"><link rel="prefetch" href="/assets/js/49.a81b7774.js"><link rel="prefetch" href="/assets/js/5.a6bc510c.js"><link rel="prefetch" href="/assets/js/50.5ae2a1df.js"><link rel="prefetch" href="/assets/js/51.1e50c0a5.js"><link rel="prefetch" href="/assets/js/52.05832c5b.js"><link rel="prefetch" href="/assets/js/6.edf1ab01.js"><link rel="prefetch" href="/assets/js/7.75a4d63f.js"><link rel="prefetch" href="/assets/js/8.ac427bc7.js"><link rel="prefetch" href="/assets/js/9.7c5ccd0b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2fbf6f8b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">车程一的博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div> <a href="https://github.com/chechengyi" target="_blank" rel="noopener noreferrer" class="repo-link">
    我的github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div> <a href="https://github.com/chechengyi" target="_blank" rel="noopener noreferrer" class="repo-link">
    我的github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>前端实战</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>js相关</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>react理解</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>总结记录</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/blog/总结记录/浏览器渲染过程以及事件循环.html" class="sidebar-link">浏览器渲染过程以及事件循环</a></li><li><a href="/blog/总结记录/Sequelize使用记录.html" class="sidebar-link">Sequelize 使用记录</a></li><li><a href="/blog/总结记录/TCP、http、udp记录.html" class="sidebar-link">TCP、http、udp记录</a></li><li><a href="/blog/总结记录/https 原理与传输.html" class="active sidebar-link">https 原理与传输</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/总结记录/https 原理与传输.html#对称加密" class="sidebar-link">对称加密</a></li><li class="sidebar-sub-header"><a href="/blog/总结记录/https 原理与传输.html#非对称加密" class="sidebar-link">非对称加密</a></li><li class="sidebar-sub-header"><a href="/blog/总结记录/https 原理与传输.html#https-通信-握手-过程" class="sidebar-link">HTTPS 通信(握手)过程</a></li></ul></li><li><a href="/blog/总结记录/编写typescript声明文件.html" class="sidebar-link">编写typescript声明文件</a></li><li><a href="/blog/总结记录/Docker 安装及使用.html" class="sidebar-link">Docker 使用</a></li><li><a href="/blog/总结记录/JS位运算.html" class="sidebar-link">JS位运算</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>数据结构算法</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="https-原理与传输"><a href="#https-原理与传输" aria-hidden="true" class="header-anchor">#</a> https 原理与传输</h1> <p><em>HTTPS</em> 其实就是在传输层和应用层，也就是 <em>HTTP</em> 协议和 <em>TCP</em> 协议中加入了一层 SSL/TSL 协议。</p> <p><em>HTTP</em> 是 超文本传输协议，在传输的过程中是明文传输的，是很不安全的，<em>HTTPS</em> 就是给传输的内容做了加密。说到加密，先了解一下两种加密方法</p> <h2 id="对称加密"><a href="#对称加密" aria-hidden="true" class="header-anchor">#</a> 对称加密</h2> <p>对称加密又叫私钥加密，即信息的发送方和接收方使用同一个密钥去加密和解密数据。对称加密的特点是算法公开，加密和解密速度都快，适合大数据量进行加密，常见的对称加密算法有：DES、3DES、TDEA、Blowfish、RC5和IDEA。</p> <p>其加密过程如下：明文 + 加密算法 + 私钥 =&gt; 密文。</p> <p>其解密过程如下：密文 + 解密算法 + 私钥 =&gt; 明文。</p> <p>对称加密中用到的密钥叫做私钥，私钥表示个人私有的密钥，即该密钥不能被泄漏。其加密过程中的私钥与解密过程中用到的私钥是同一个密钥，这也是称加密之所以称之为“对称”的原因。由于对称加密的算法是公开的，所以一旦私钥被泄露，那么密文就很容易被破解，所以对称加密的缺点是密钥安全管理困难。</p> <h2 id="非对称加密"><a href="#非对称加密" aria-hidden="true" class="header-anchor">#</a> 非对称加密</h2> <p>非对称加密也叫公钥加密。非对称加密安全性比对称加密要好。对称加密的通信双方使用相同的密钥，如果一方的密钥遭泄露，那么整个通信就会被破解。而非对称加密使用一对密钥，即公钥和私钥，且二者成对出现。私钥被自己保存，不能对外泄露。公钥指的是公共的密钥，任何人都可以获得该密钥。用公钥或私钥中的任何一个进行加密，用另一个进行解密。</p> <p>被公钥加密过的密文只能被私钥解密，过程如下：</p> <p>明文 + 加密算法 + 公钥 =&gt; 密文， 密文 + 解密算法 + 私钥 =&gt; 明文</p> <p>被私钥加密过的密文只能被公钥解密，过程如下：</p> <p>明文 + 加密算法 + 私钥 =&gt; 密文， 密文 + 解密算法 + 公钥 =&gt; 明文</p> <p>非对称加密的缺点是加密和解密花费时间长、速度慢，只适合对少量数据进行加密。</p> <p>在非对称加密中使用的主要算法有：RSA、Elgamal、Rabin、D-H、ECC（椭圆曲线加密算法）等。</p> <h2 id="https-通信-握手-过程"><a href="#https-通信-握手-过程" aria-hidden="true" class="header-anchor">#</a> HTTPS 通信(握手)过程</h2> <p><em>HTTPS</em> 通信过程中两种加密方式都采用了。为了考虑传输效率对传输的内容做对称加密，为了安全性对 对称加密 的密钥做非对称加密。以下是 HTTPS 的握手过程。通过查阅资料得知，并不是每一次请求都需要重新握手的，其中有一些优化手段。</p> <ul><li>客户端发送 TLS版本号+所支持加密套件列表+希望使用的TLS选项</li> <li>服务端 选择一个客户端的加密套件+自己的证书（公钥）+希望使用的TLS选项；</li> <li>客户端接收到服务端选择的加密套件、算法等，还有服务端返回的证书（公钥）。然后客户端会解析这个证书，-首先验证公钥是否有效，比如颁发时间、过期时间等等。如果有异常就会弹出警告框警告证书有问题。如果证书- 没有问题就生成一个随机值，然后用证书（公钥）对随机值进行 非对称加密。</li> <li>客户端将这个加密后的值发送给服务端，服务端用自己的私钥和自己所选取的加密算法等信息解密得到客户端生- 成的随机值。这个随机值就是后续客户端和服务端通信过程中对内容进行对称加密的密钥。
<img src="https://ae01.alicdn.com/kf/H5a5fe6c278ca4f4db48ac60c5d648fa9C.png" alt></li></ul> <p>刚刚有说到，并不是每一次 HTTP 请求都需要重新握手的</p> <p>接下是一段在知乎上搜寻到的回答：</p> <blockquote><p>浏览器客户端访问同一个 HTTPS 服务器，可以不必每次都进行完整的握手过程，因为完整的握手过程，涉及到<strong>认证服务器的身份</strong>（数字证书），需要做大量的非对称加密/解密运算，此外还需要做<strong>伪随机函数PRF</strong>，通过“<strong>Pre-Master Key”、“Server Nonce”、“Client Nonce</strong>”共同推导出 <strong>session key</strong>，<strong>非对称加密算法RSA/DSA非常耗费CPU资源。</strong></p></blockquote> <blockquote><p>为了克服这个困难，服务器维护一个以 <strong>session ID</strong> 为索引的结构体，用于临时存放 <strong>session key</strong>，并在 <strong>TLS handshake（握手阶段） 阶段将 session ID 分享给浏览器</strong>。</p></blockquote> <blockquote><p>当浏览器重新连接 HTTPS 服务器时， 握手阶段，出示自己的 <strong>session ID</strong> ，<strong>服务器获得 session ID ，以此为索引，可以获得和该浏览器共同拥有的session key，使用 session key 可以直接对用户流量做加密/解密动作。</strong> 这样避免了大量的幂、指数计算。</p></blockquote> <blockquote><p>当然，如果服务器没有查找到 <strong>session ID</strong> ，双方的TLS安全参数协商按照正常流程走。</p></blockquote> <blockquote><p>作者：车小胖
链接：https://www.zhihu.com/question/67740663/answer/256288406
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote> <p>现在结合这个在总结一下我所理解的握手的过程：</p> <p>总的来说，就是 在 <strong>TSL握手</strong> 客户端将后面用于对称加密的随机值（为了方便表示，后面称之为 <strong>会话密钥</strong>）发送给服务端之后，服务端会将这个 <strong>会话密钥</strong> 以 <strong>session ID</strong> 为索引的结构体临时保存 （ <strong>session ID</strong> - <strong>session key</strong> ）然后将 <strong>session ID</strong> 在发送到客户端。</p> <p>客户端每次在像服务端发起 <strong>TSL握手</strong> 的时候都会携带上 <strong>session ID</strong>，这样服务端在校验客户端有携带 <strong>session ID</strong>，并且通过这个 <strong>sesson ID</strong> 能取到 <strong>session key</strong> 那么 <strong>TSL</strong> 的握手过程就可以简化了。</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.7b18d2f0.js" defer></script><script src="/assets/js/32.9d1685a0.js" defer></script>
  </body>
</html>
