<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>react实现一个分页、搜索高阶组件 | 车程一的博客</title>
    <meta name="description" content="车程一的博客">
    <link rel="icon" href="/vue-logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.2fbf6f8b.css" as="style"><link rel="preload" href="/assets/js/app.7b18d2f0.js" as="script"><link rel="preload" href="/assets/js/18.0b08fef9.js" as="script"><link rel="prefetch" href="/assets/js/10.ea08bc69.js"><link rel="prefetch" href="/assets/js/11.59d62fd9.js"><link rel="prefetch" href="/assets/js/12.426af9d7.js"><link rel="prefetch" href="/assets/js/13.b2bd6144.js"><link rel="prefetch" href="/assets/js/14.1790ff5e.js"><link rel="prefetch" href="/assets/js/15.584f93ea.js"><link rel="prefetch" href="/assets/js/16.659d2a43.js"><link rel="prefetch" href="/assets/js/17.7825b058.js"><link rel="prefetch" href="/assets/js/19.c553a9ae.js"><link rel="prefetch" href="/assets/js/2.ef1579f9.js"><link rel="prefetch" href="/assets/js/20.1a95086a.js"><link rel="prefetch" href="/assets/js/21.57c66887.js"><link rel="prefetch" href="/assets/js/22.3570ca0d.js"><link rel="prefetch" href="/assets/js/23.7fe8ebe9.js"><link rel="prefetch" href="/assets/js/24.5c706192.js"><link rel="prefetch" href="/assets/js/25.d8757158.js"><link rel="prefetch" href="/assets/js/26.8399a71b.js"><link rel="prefetch" href="/assets/js/27.4b3a213a.js"><link rel="prefetch" href="/assets/js/28.eb31cdf1.js"><link rel="prefetch" href="/assets/js/29.577144a6.js"><link rel="prefetch" href="/assets/js/3.62eea2c7.js"><link rel="prefetch" href="/assets/js/30.ef956d23.js"><link rel="prefetch" href="/assets/js/31.2e8ab40d.js"><link rel="prefetch" href="/assets/js/32.9d1685a0.js"><link rel="prefetch" href="/assets/js/33.d800be4d.js"><link rel="prefetch" href="/assets/js/34.85d350fe.js"><link rel="prefetch" href="/assets/js/35.1625e166.js"><link rel="prefetch" href="/assets/js/36.5cf7699d.js"><link rel="prefetch" href="/assets/js/37.0437fe8d.js"><link rel="prefetch" href="/assets/js/38.ca058290.js"><link rel="prefetch" href="/assets/js/39.d4f95e20.js"><link rel="prefetch" href="/assets/js/4.91c625b2.js"><link rel="prefetch" href="/assets/js/40.211acfac.js"><link rel="prefetch" href="/assets/js/41.a5df0168.js"><link rel="prefetch" href="/assets/js/42.6318b490.js"><link rel="prefetch" href="/assets/js/43.a6543bac.js"><link rel="prefetch" href="/assets/js/44.b04565e5.js"><link rel="prefetch" href="/assets/js/45.3bb1a5c1.js"><link rel="prefetch" href="/assets/js/46.15ed4362.js"><link rel="prefetch" href="/assets/js/47.e838dcd2.js"><link rel="prefetch" href="/assets/js/48.0a220d6c.js"><link rel="prefetch" href="/assets/js/49.a81b7774.js"><link rel="prefetch" href="/assets/js/5.a6bc510c.js"><link rel="prefetch" href="/assets/js/50.5ae2a1df.js"><link rel="prefetch" href="/assets/js/51.1e50c0a5.js"><link rel="prefetch" href="/assets/js/52.05832c5b.js"><link rel="prefetch" href="/assets/js/6.edf1ab01.js"><link rel="prefetch" href="/assets/js/7.75a4d63f.js"><link rel="prefetch" href="/assets/js/8.ac427bc7.js"><link rel="prefetch" href="/assets/js/9.7c5ccd0b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2fbf6f8b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">车程一的博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div> <a href="https://github.com/chechengyi" target="_blank" rel="noopener noreferrer" class="repo-link">
    我的github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div> <a href="https://github.com/chechengyi" target="_blank" rel="noopener noreferrer" class="repo-link">
    我的github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>前端实战</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/blog/前端实战/跨域及其处理方式.html" class="sidebar-link">跨域及其处理方式</a></li><li><a href="/blog/前端实战/移动端适配问题.html" class="sidebar-link">移动端适配问题</a></li><li><a href="/blog/前端实战/给localStorage加上过期时间.html" class="sidebar-link">给localStorage加上过期时间</a></li><li><a href="/blog/前端实战/react实现一个分页、搜索高阶组件.html" class="active sidebar-link">react实现一个分页、搜索高阶组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/前端实战/react实现一个分页、搜索高阶组件.html#一、前言" class="sidebar-link">一、前言</a></li><li class="sidebar-sub-header"><a href="/blog/前端实战/react实现一个分页、搜索高阶组件.html#二、思考这个高阶组件要解决什么问题" class="sidebar-link">二、思考这个高阶组件要解决什么问题</a></li><li class="sidebar-sub-header"><a href="/blog/前端实战/react实现一个分页、搜索高阶组件.html#三、开始编写" class="sidebar-link">三、开始编写</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/前端实战/react实现一个分页、搜索高阶组件.html#_1、搭好架子" class="sidebar-link">1、搭好架子</a></li><li class="sidebar-sub-header"><a href="/blog/前端实战/react实现一个分页、搜索高阶组件.html#_2、把配置项提出来" class="sidebar-link">2、把配置项提出来</a></li><li class="sidebar-sub-header"><a href="/blog/前端实战/react实现一个分页、搜索高阶组件.html#_3、给予组件翻页，和搜索的功能" class="sidebar-link">3、给予组件翻页，和搜索的功能</a></li><li class="sidebar-sub-header"><a href="/blog/前端实战/react实现一个分页、搜索高阶组件.html#_4、如何使用" class="sidebar-link">4、如何使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/前端实战/react实现一个分页、搜索高阶组件.html#四、总结" class="sidebar-link">四、总结</a></li></ul></li><li><a href="/blog/前端实战/nginx设置资源缓存实战.html" class="sidebar-link">nginx设置资源缓存实战</a></li><li><a href="/blog/前端实战/前后端分离下前端权限处理.html" class="sidebar-link">前后端分离下前端权限处理</a></li><li><a href="/blog/前端实战/从react hooks“闭包陷阱”切入，浅谈react hooks.html" class="sidebar-link">从react hooks“闭包陷阱”切入，浅谈react hooks</a></li><li><a href="/blog/前端实战/BFC及其理解.html" class="sidebar-link">BFC及其理解</a></li><li><a href="/blog/前端实战/react优化-精确更新视窗内组件.html" class="sidebar-link">react优化-精确更新视窗内组件</a></li><li><a href="/blog/前端实战/typescript内置类型学习.html" class="sidebar-link">typescript内置类型学习</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>js相关</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>react理解</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>总结记录</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>数据结构算法</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="react实现一个分页、搜索高阶组件"><a href="#react实现一个分页、搜索高阶组件" aria-hidden="true" class="header-anchor">#</a> react实现一个分页、搜索高阶组件</h1> <h2 id="一、前言"><a href="#一、前言" aria-hidden="true" class="header-anchor">#</a> 一、前言</h2> <p>先感谢掘金这个平台让我可以看到别人的思想，别人的智慧。说真的，在这个平台上还是看到了许多有营养的文章。目前的我是产不出像大佬那样富有营养的文章，那就记录一点我在工作中的事情，如有说错的地方或是有不合理的地方，希望各位大佬指出。</p> <p>项目的背景是做一个总管理后台，我的那个项目直接用的就是蚂蚁金服的<a href="https://pro.ant.design/docs/getting-started-cn" target="_blank" rel="noopener noreferrer">ant-design-pro<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，不得不夸赞这个真的是太好用了。然后做这种管理后台总是会遇到很多表格，列表之类的展示，一般的表格和列表都会有两个最基本的诉求，那就是分页和搜索。然后我的代码中就充斥了很多这样的逻辑。 在 <code>componentDidMount</code> 的时候发送请求加载数据，在页码改变的时候加载数据，在客户搜索的时候加载数据......</p> <p>总之就是我写了很多功能重复的代码，不行，我是一个善于思（作）考（死）的人，我要想一个办法去解决这个问题！然后我感觉react的高阶组件可以应用于此场景。</p> <h2 id="二、思考这个高阶组件要解决什么问题"><a href="#二、思考这个高阶组件要解决什么问题" aria-hidden="true" class="header-anchor">#</a> 二、思考这个高阶组件要解决什么问题</h2> <p>本文就不在此说高阶组件到底是什么，本文主要探讨的目标在于如何利用高阶组件去解决问题，如果有对高阶组件不甚了解的同学可以先看看 <a href="https://react.docschina.org/docs/higher-order-components.html" target="_blank" rel="noopener noreferrer">react官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 。</p> <p>接下来的探讨就基本我本次开发的项目中，先讲一下本次项目开发采用的技术栈。本次是开发一个后台管理系统，项目使用了 <code>antd</code>、<code>dva</code>。 其实其他的都不重要了，最重要的是这个 <code>dva</code> ，使用过的同学应该都知道，它提供了一个 <code>model</code> 的概念。也就是说我们所获取的数据是要用这个 <code>model</code> 去管理的。我这个高阶组件要实现的最基本的功能有一下两点：</p> <ul><li><p>翻页获取数据</p></li> <li><p>能够根据表单搜索数据</p></li></ul> <h2 id="三、开始编写"><a href="#三、开始编写" aria-hidden="true" class="header-anchor">#</a> 三、开始编写</h2> <h3 id="_1、搭好架子"><a href="#_1、搭好架子" aria-hidden="true" class="header-anchor">#</a> 1、搭好架子</h3> <p>废话就不多说了，开始编写这个高阶组件，先把这个组件写出来再说！新建一个<code>table.js</code>文件，这个文件有以下内容：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span>WarpComponent<span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> React<span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
       state <span class="token operator">=</span> <span class="token punctuation">{</span>
           formValues<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// 表单搜素字段</span>
           page<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token comment">// 分页页码</span>
           num<span class="token punctuation">:</span> <span class="token number">10</span>
       <span class="token punctuation">}</span>
       <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>WarpComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>    
           <span class="token punctuation">)</span>
       <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在写出来的这个高阶组件已经可以直接使用了，使用的时候只需要：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> TableHoc <span class="token keyword">from</span> <span class="token string">'xxx'</span>

@TabelHoc
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">XXX</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token comment">// 相当于 TableHoc(XXX)</span>
</code></pre></div><p>可以看见其实高阶组件就是一个函数，接收了组件然后返回了组件。可以看到在渲染被包裹的那个组件的时候把 <code>props</code> 全部解构给了被包裹的这个组件，这并不是多此一举。想象一下如果这个<code>WarpComponent</code> 原本刚好是一个路由组件，当你在定义路由的页面去引用这个组件的时候，它已经被高阶组件包裹了，就是说对原本的这个 <code>WarpComponent</code> 的 <code>props</code> 传递的值现在都传递到了我们所编写的高阶组件上去了，所以，在这里，我们将原本属于<code>WarpComponent</code> 的 <code>props</code> “还” 给它。</p> <h3 id="_2、把配置项提出来"><a href="#_2、把配置项提出来" aria-hidden="true" class="header-anchor">#</a> 2、把配置项提出来</h3> <p>在上面的编写中我把分页的页码和条数都设定死了，其实这是很不友好的。我们应该让它变成一个可以配置的项。修改以上的代码为：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">,</span> page<span class="token punctuation">,</span> num<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> WrapComponent <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> React<span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
        state <span class="token operator">=</span> <span class="token punctuation">{</span>
            formValues<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            page<span class="token punctuation">:</span> page <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">,</span>
            num<span class="token punctuation">:</span> num <span class="token operator">||</span> <span class="token number">10</span>
        <span class="token punctuation">}</span>
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>
                <span class="token operator">&lt;</span>WarpComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span> 
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在使用的时候只需要：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> TableHoc <span class="token keyword">from</span> <span class="token string">'xxx'</span>

@<span class="token function">TableHoc</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    page<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token comment">// 这里传了多少那高阶组件里初始化的值就是多少</span>
    num<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">'xxx'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">XXX</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p>这里说一下这个 <code>type</code> 是什么，其实这个 <code>type</code> 需不需要取决于你自己的项目。比如我这个项目，我用了 <code>dva</code> 那数据我都是用集中管理在 <code>models</code> 的。用过 <code>dva</code> 的朋友都知道，它有一个 <code>命名空间</code> 的概念，就是在 <code>dispatch</code> 的时候有一个 <code>type</code> 需要我们去传嘛。如果你没有使用 <code>dva</code> 或者 <code>redux</code> 。 那就直接在这个高阶组件里去管理、获取数据然后作为 <code>props</code> 传给被包裹的组件就行了，那相应的你也不需要这个 <code>type</code>参数了。</p> <p>还有一个问题，就是这个高阶组件它需要去执行 <code>dispatch</code> 操作嘛，那就先需要 <code>connect</code> ，注意，这里你是使用的 <code>dva</code> 还是 <code>redux</code> 其实根本没区别， 本质上这个 <code>connect</code> 也是一个高阶组件。现在我把 <code>connect</code> 写上去：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> TableHoc <span class="token keyword">from</span> <span class="token string">'xxx'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'dva'</span>

@<span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
@<span class="token function">TableHoc</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     page<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 这里传了多少那高阶组件里初始化的值就是多少</span>
     num<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
     type<span class="token punctuation">:</span> <span class="token string">'xxx'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">XXX</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p>需要注意的是这个 <code>connect</code> 一定要写到 <code>TableHoc</code> 前面。</p> <h3 id="_3、给予组件翻页，和搜索的功能"><a href="#_3、给予组件翻页，和搜索的功能" aria-hidden="true" class="header-anchor">#</a> 3、给予组件翻页，和搜索的功能</h3> <p>现在要说的就是这个组件核心的功能，翻页和搜索，现在 <code>TableHoc</code> 组件里写上两个方法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function-variable function">searchData</span> <span class="token operator">=</span> formValues <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        page<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        formValues
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getData<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function-variable function">handlePageChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>page<span class="token punctuation">,</span> num<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        page<span class="token punctuation">,</span>
        num
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getData<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>先不去管 <code>this.getData</code> 这个方法，这个两个方法明显就是要给被包裹的组件使用的，所以要传给被包裹的组件。还有页码，被包裹的组件在翻页的时候肯定也是需要展示页码的，所以都传下去。</p> <p>改写 <code>render</code> 方法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>WrapComponent
         ref<span class="token operator">=</span><span class="token punctuation">{</span>com <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>warpCom <span class="token operator">=</span> com<span class="token punctuation">}</span>
         <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span>
         <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">}</span>
         searchData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchData<span class="token punctuation">}</span>
         handlePageChange <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlePageChange<span class="token punctuation">}</span>
         resetData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>resetData<span class="token punctuation">}</span>
         <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以注意我给被包裹的组件加上了一个 <code>ref</code> 属性，这样我就可以拿到组件的实例了。为什么要加呢，主要是我考虑到一种情况，就是除了翻页、还有表单搜索这样的一些搜索字段，可能还有一个额外的参数需要用作搜索，所以我把这个决定的权利给到被包裹的组件。接下来完善 <code>this.getData</code> 方法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function-variable function">getData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> elseSearchPrams <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>warpCom <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>warpCom<span class="token punctuation">.</span>getSearchParams <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        elseSearchPrams <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>warpCom<span class="token punctuation">.</span><span class="token function">getSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> page<span class="token punctuation">,</span> num<span class="token punctuation">,</span> formValues <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token punctuation">,</span>
        payload<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            page<span class="token punctuation">,</span>
            num<span class="token punctuation">,</span>
            <span class="token operator">...</span>formValues<span class="token punctuation">,</span>
            <span class="token operator">...</span>elseSearchPrams
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到我试着去获取了一下 <code>warpCom</code> 有没有额外需要传入搜索的参数，在 <code>warpCom</code> 中只需要去定义一个名为 <code>getSearchParams</code> 的方法，然后返回一个包含搜索信息的对象就可以了。这里的 <code>this.props.dispath</code> 是 <code>dva</code> 提供给我的方法，我只需要根据 <code>dva</code> 定义的去使用去就可以了。 如果想直接使用 <code>redux</code> 的话按照 <code>redux</code> 那一套就可以了，使用 <code>redux</code> 的话这里就是 发起一个 <code>action</code>， 那么很简单，传进来的那个 <code>type</code> 只要改成 <code>redux</code> 的 <code>action</code> 就可以了。</p> <p>然后还有一个 <code>resetData</code> 方法，很明显的如果要 <code>reset</code> 的话，需要重置页码还有搜索参数：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function-variable function">resetData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        page<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        formValues<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getData<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后是获取数据，一般都是在 <code>componentDidMount</code> 生命周期里去获取。所以在加上代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4、如何使用"><a href="#_4、如何使用" aria-hidden="true" class="header-anchor">#</a> 4、如何使用</h3> <p>组件的代码我们是已经编写完了。组件很简单，使用起来也很简单。只需要在页码改变的时候，或者是搜索参数改变的时候去调用这个高阶组件所提供的 <code>handlePageChange</code> 方法和 <code>searchData</code> 方法就可以了。这里我提供一个<a href="https://github.com/Chechengyi/antd-admin/blob/master/src/routes/TableList/TableList.js" target="_blank" rel="noopener noreferrer">使用范例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，范例中有完整的高阶组件的代码，也有完整的使用的代码。 在这个项目中使用了 <code>antd</code> <code>dva</code> ，很真实的使用环境，希望可以提供帮助。在项目数据mock服务中我只处理了页码，没有去管搜索参数，有疑问可以打开 network看看搜索参数是否正常传递。</p> <p>如果有疑问可以在掘金下回复我，也可以在我贴出的git项目的 issue中提出问题，我会尽力解答。</p> <h2 id="四、总结"><a href="#四、总结" aria-hidden="true" class="header-anchor">#</a> 四、总结</h2> <p>文章写完啦，深深的感觉自己的陈述能力不足。言归正传，这就是一次高阶组件的使用，其实很多设计都是用到了高阶组件，就比如说 <code>redux</code> 的 <code>connect</code> , 用过 <code>antd</code> 的朋友应该也知道在表单验证的时候有 <code>Form.create</code> 和 <code>getFieldDecorator</code> 。这些都是很经典的使用，平时我也喜欢用高阶组件去做一些权限处理啊什么的。 虽然说现在 <code>react</code> 已经推出了 <code>hooks</code> ，可能 <code>class</code> 类型的组件被淘汰掉只是时间的问题。试着去了解了一下 <code>hooks</code> 觉得我get不到其中的思想。等后续我再试着了解 <code>hooks</code> 看看能不能带来一个 <code>hooks</code> 的实现版本。</p> <p>水平有限，可能说的有一些错的地方我却不自知， 希望大家指正。</p> <p>最后：</p> <p>使用范例地址：<a href="https://github.com/Chechengyi/antd-admin/blob/master/src/hoc/table.tsx" target="_blank" rel="noopener noreferrer">https://github.com/Chechengyi/antd-admin/blob/master/src/hoc/table.tsx<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>我的 github地址：<a href="https://github.com/Chechengyi" target="_blank" rel="noopener noreferrer">https://github.com/Chechengyi<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>码字不易，欢迎朋友们来一波 star 或者 赞。</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.7b18d2f0.js" defer></script><script src="/assets/js/18.0b08fef9.js" defer></script>
  </body>
</html>
