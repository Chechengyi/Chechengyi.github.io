(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{200:function(o,e,t){"use strict";t.r(e);var a=t(0),i=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("div",{staticClass:"content"},[t("h1",{attrs:{id:"关于-cookie-的一些思考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关于-cookie-的一些思考","aria-hidden":"true"}},[o._v("#")]),o._v(" 关于 Cookie 的一些思考")]),o._v(" "),t("p",[o._v("大概是在 2020年的3月份还是4月份的一天，此时的我是手淘下某团队的一名外包开发，跟往常一样打开电脑开始开发。打开了淘宝网的登录页面，URL 为：main.m.taobao.com（这是线上投入使用的）输入测试账户名和密码。然后将我本地的项目启动了，由于我本地使用 IHosts 设置了一个 demo.taobao.com 的域名解析到本地的 IP 地址，所以我直接访问了 demo.taobao.com。按照以前的情况，在 main.m.taobao.com 下我登录了，服务端给我下发了 Cookie，这个 Cookie 的 document.domain 是 "),t("code",[o._v(".taobao.com")]),o._v(" 所以在二、三级域名不同，但是顶级域名相同的情况下，"),t("code",[o._v("demo.taobao.com")]),o._v(" 这个站是可以拿到 Cookie 的，但是这次我确失败了。")]),o._v(" "),t("blockquote",[t("p",[o._v("在Chrome 80版本中，Chrome会将没有声明"),t("code",[o._v("SameSite")]),o._v("值的"),t("code",[o._v("cookie")]),o._v("默认设置为"),t("code",[o._v("SameSite=Lax")]),o._v("。只有采用"),t("code",[o._v("SameSite=None; Secure")]),o._v("设置的"),t("code",[o._v("cookie")]),o._v("可以从外部访问，前提是通过安全连接（即"),t("code",[o._v("HTTPS")]),o._v("）访问。")])]),o._v(" "),t("p",[o._v("原因在于 Chrom 浏览器针对 Cookie 做了限制。这里涉及到了 Cookie 的一个属性："),t("code",[o._v("SameSite")]),o._v("，具体这个属性的值代表哪些含义，就不再次多做赘述了。问题的关键点在于，我本地的服务启动后，协议是 HTTPS 的，而 "),t("code",[o._v("SameSite")]),o._v(" 即使设置为了最为宽松的 "),t("code",[o._v("none")]),o._v(" 仍然要求请求发送方是 HTTPS 协议，异步请求才会携带相关的 Cookie。而打开控制器，也确实发现淘宝对用于鉴别用户信息相关的 Cookie 使用的 "),t("code",[o._v("SameSite")]),o._v("值都是 "),t("code",[o._v("none")])]),o._v(" "),t("h2",{attrs:{id:"一、关于三方-cookie-的一些思考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、关于三方-cookie-的一些思考","aria-hidden":"true"}},[o._v("#")]),o._v(" 一、关于三方 Cookie 的一些思考")]),o._v(" "),t("p",[o._v("很多人指责三方 Cookie 泄漏了用户的隐私。举个例子，A 站点与 B 站点有合作关系。A 站点是一个卖商品的网站，而 B 站点是一个浏览资讯的网站，我同时是两个站点的用户。我已经登录 A站点了，A 站点在我的浏览器上设置了相关的 Cookie 信息。然后我在 B 站点上浏览，我点进了一条关于摩托车测试的新闻，此时 B 站点像 A站点发送了一个请求，可以是通过表单、img标签或者一个异步请求（当然，在没有A站点没有设置 CORS 的时候会提示跨域）最重要的一点是，浏览器会将这条在 B 站点 发送的 A 站点的请求，携带上 A站点的 Cookie，通过 Cookie，A 站点就能知道 我的某个用户访问了 B 站点，如果请求上携带一些参数的话，就会知道，我的某个用户 在 B 站点浏览了摩托车的新闻，或许他需要一辆摩托车，所以我将这个商品推送给他。")]),o._v(" "),t("p",[o._v("https://zhuanlan.zhihu.com/p/140387175")])])}],!1,null,null,null);e.default=i.exports}}]);